# å‘å¸ƒæŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ GitHub Actions å·¥ä½œæµå‘å¸ƒ Docker é•œåƒå’Œåˆ›å»ºç‰ˆæœ¬å‘å¸ƒã€‚

## ğŸ“‹ å‰ç½®å‡†å¤‡

åœ¨å‘å¸ƒä¹‹å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **ä»£ç å·²ç»è¿‡æµ‹è¯•**ï¼šæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **æ›´æ–°äº†æ–‡æ¡£**ï¼šREADME.md ç­‰æ–‡æ¡£å·²æ›´æ–°
3. **æäº¤äº†æ‰€æœ‰æ›´æ”¹**ï¼šæ²¡æœ‰æœªæäº¤çš„æ”¹åŠ¨
4. **è®¾ç½®äº†ä»“åº“æƒé™**ï¼š
   - è¿›å…¥ä»“åº“ Settings > Actions > General
   - åœ¨ Workflow permissions ä¸­é€‰æ‹© "Read and write permissions"
   - å‹¾é€‰ "Allow GitHub Actions to create and approve pull requests"
   - ç‚¹å‡» Save

## ğŸš€ å‘å¸ƒ 1.0 ç‰ˆæœ¬

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Git æ ‡ç­¾ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•å’Œæ¨èçš„æ–¹æ³•ï¼š

```bash
# 1. ç¡®ä¿åœ¨ä¸»åˆ†æ”¯ä¸Š
git checkout main  # æˆ– master

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0 - åˆå§‹å‘å¸ƒ"

# 4. æ¨é€æ ‡ç­¾åˆ° GitHub
git push origin v1.0.0
```

æ¨é€æ ‡ç­¾åï¼ŒGitHub Actions ä¼šè‡ªåŠ¨ï¼š
- æ„å»ºåç«¯å’Œå‰ç«¯ Docker é•œåƒ
- æ¨é€é•œåƒåˆ° GitHub Container Registry
- åˆ›å»º v1.0.0 çš„ Release
- ç”Ÿæˆå‘å¸ƒè¯´æ˜
- é™„åŠ  docker-compose.release.yml å’Œ .env.example

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

å¦‚æœä½ æƒ³æ‰‹åŠ¨æ§åˆ¶å‘å¸ƒè¿‡ç¨‹ï¼š

1. è®¿é—®ä½ çš„ GitHub ä»“åº“
2. ç‚¹å‡»é¡¶éƒ¨çš„ **Actions** æ ‡ç­¾
3. åœ¨å·¦ä¾§é€‰æ‹© **Docker Build, Push and Release** å·¥ä½œæµ
4. ç‚¹å‡»å³ä¾§çš„ **Run workflow** ä¸‹æ‹‰æŒ‰é’®
5. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
   - é€‰æ‹©åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ mainï¼‰
   - è¾“å…¥ç‰ˆæœ¬å·ï¼š`1.0.0`ï¼ˆä¸éœ€è¦ 'v' å‰ç¼€ï¼‰
6. ç‚¹å‡»ç»¿è‰²çš„ **Run workflow** æŒ‰é’®

## ğŸ“Š ç›‘æ§æ„å»ºè¿‡ç¨‹

1. åœ¨ **Actions** é¡µé¢æŸ¥çœ‹å·¥ä½œæµè¿è¡ŒçŠ¶æ€
2. ç‚¹å‡»æ­£åœ¨è¿è¡Œçš„å·¥ä½œæµæŸ¥çœ‹è¯¦ç»†æ—¥å¿—
3. æ„å»ºé€šå¸¸éœ€è¦ 10-15 åˆ†é’Ÿå®Œæˆ

å·¥ä½œæµåŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
- âœ… æ£€å‡ºä»£ç 
- âœ… è®¾ç½® Docker Buildx
- âœ… ç™»å½•åˆ° GHCR
- âœ… æ„å»ºå¹¶æ¨é€åç«¯é•œåƒ
- âœ… æ„å»ºå¹¶æ¨é€å‰ç«¯é•œåƒ
- âœ… åˆ›å»º Release
- âœ… ä¸Šä¼ æ–‡ä»¶åˆ° Release

## ğŸ¯ éªŒè¯å‘å¸ƒ

### 1. æ£€æŸ¥ Release

1. è®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/releases`
2. åº”è¯¥èƒ½çœ‹åˆ° **v1.0.0** çš„å‘å¸ƒ
3. æ£€æŸ¥å‘å¸ƒè¯´æ˜æ˜¯å¦æ­£ç¡®
4. ç¡®è®¤é™„ä»¶åŒ…å«ï¼š
   - `docker-compose.release.yml`
   - `.env.example`

### 2. æ£€æŸ¥ Docker é•œåƒ

1. è®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/pkgs/container/ä½ çš„ä»“åº“-backend`
2. æŸ¥çœ‹ backend é•œåƒæ˜¯å¦å·²æ¨é€
3. æ£€æŸ¥æ ‡ç­¾ï¼š1.0.0, 1.0, 1, latest
4. é‡å¤ä»¥ä¸Šæ­¥éª¤æ£€æŸ¥ frontend é•œåƒ

### 3. æµ‹è¯•é•œåƒ

```bash
# æ‹‰å–é•œåƒ
docker pull ghcr.io/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“-backend:1.0.0
docker pull ghcr.io/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“-frontend:1.0.0

# éªŒè¯é•œåƒ
docker images | grep volcengine
```

## ğŸ³ ä½¿ç”¨å‘å¸ƒçš„é•œåƒ

### å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆ›å»ºå·¥ä½œç›®å½•
mkdir volcengine-app && cd volcengine-app

# 2. ä¸‹è½½ docker-compose é…ç½®
curl -O https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/releases/download/v1.0.0/docker-compose.release.yml
mv docker-compose.release.yml docker-compose.yml

# 3. ä¸‹è½½ç¯å¢ƒå˜é‡æ¨¡æ¿
curl -O https://github.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“/releases/download/v1.0.0/.env.example
mv .env.example .env

# 4. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ç«å±±å¼•æ“å‡­è¯
nano .env  # æˆ–ä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨

# 5. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 6. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 7. è®¿é—®åº”ç”¨
# æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000
```

### åœæ­¢æœåŠ¡

```bash
docker-compose down
```

### æ›´æ–°åˆ°æ–°ç‰ˆæœ¬

```bash
# æ‹‰å–æ–°ç‰ˆæœ¬é•œåƒ
docker-compose pull

# é‡å¯æœåŠ¡
docker-compose up -d
```

## ğŸ”§ é•œåƒå¯è§æ€§è®¾ç½®

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨é€åˆ° GHCR çš„é•œåƒæ˜¯ç§æœ‰çš„ã€‚å¦‚æœè¦å…¬å¼€é•œåƒï¼š

### å…¬å¼€åç«¯é•œåƒ

1. è®¿é—® `https://github.com/ä½ çš„ç”¨æˆ·å?tab=packages`
2. ç‚¹å‡» `ä½ çš„ä»“åº“-backend` åŒ…
3. ç‚¹å‡»å³ä¾§çš„ **Package settings**
4. æ»šåŠ¨åˆ° **Danger Zone**
5. ç‚¹å‡» **Change visibility**
6. é€‰æ‹© **Public**
7. è¾“å…¥ä»“åº“åç§°ç¡®è®¤
8. ç‚¹å‡»ç¡®è®¤æŒ‰é’®

### å…¬å¼€å‰ç«¯é•œåƒ

é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œä½†é€‰æ‹© `ä½ çš„ä»“åº“-frontend` åŒ…ã€‚

## ğŸ“ ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ª[è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶](https://semver.org/lang/zh-CN/)ï¼š

- **ä¸»ç‰ˆæœ¬å·**ï¼šä¸å…¼å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**ï¼šå‘åå…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢  
- **ä¿®è®¢å·**ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£

ç¤ºä¾‹ï¼š
- `v1.0.0` - é¦–æ¬¡æ­£å¼å‘å¸ƒ
- `v1.0.1` - Bug ä¿®å¤
- `v1.1.0` - æ·»åŠ æ–°åŠŸèƒ½
- `v2.0.0` - é‡å¤§æ›´æ–°ï¼ˆå¯èƒ½åŒ…å«ç ´åæ€§å˜æ›´ï¼‰

## ğŸ“ æœ€ä½³å®è·µ

1. **æµ‹è¯•åå‘å¸ƒ**
   ```bash
   # åœ¨æœ¬åœ°æµ‹è¯•æ„å»º
   docker-compose build
   docker-compose up -d
   # æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
   docker-compose down
   ```

2. **ä¿æŒç‰ˆæœ¬ä¸€è‡´**
   - ç¡®ä¿ `backend/app/config.py` ä¸­çš„ `APP_VERSION` ä¸å‘å¸ƒç‰ˆæœ¬ä¸€è‡´
   - å¯ä»¥è€ƒè™‘è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹

3. **ç¼–å†™å‘å¸ƒè¯´æ˜**
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„æ ‡ç­¾æ¶ˆæ¯
   - æè¿°æ–°åŠŸèƒ½ã€ä¿®å¤å’Œæ”¹è¿›

4. **å¤‡ä»½æ•°æ®**
   - å‡çº§å‰å¤‡ä»½ `./data` ç›®å½•
   ```bash
   cp -r ./data ./data.backup
   ```

5. **æ¸è¿›å¼éƒ¨ç½²**
   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - å†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå·¥ä½œæµæƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Resource not accessible by integration
```

**è§£å†³æ–¹æ³•**ï¼š
1. è¿›å…¥ Settings > Actions > General
2. é€‰æ‹© "Read and write permissions"
3. ä¿å­˜è®¾ç½®
4. é‡æ–°è¿è¡Œå·¥ä½œæµ

### é—®é¢˜ 2ï¼šæ— æ³•æ¨é€é•œåƒ

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: denied: permission_denied
```

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿ GitHub Token æœ‰ packages:write æƒé™ï¼ˆå·¥ä½œæµå·²é…ç½®ï¼‰
- æ£€æŸ¥ä»“åº“çš„ Package è®¾ç½®

### é—®é¢˜ 3ï¼šæ ‡ç­¾å·²å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**ï¼š
```
fatal: tag 'v1.0.0' already exists
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# åˆ é™¤æœ¬åœ°æ ‡ç­¾
git tag -d v1.0.0

# åˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼ˆè°¨æ…æ“ä½œï¼ï¼‰
git push origin :refs/tags/v1.0.0

# é‡æ–°åˆ›å»ºæ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

### é—®é¢˜ 4ï¼šDocker é•œåƒæ‹‰å–å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error response from daemon: pull access denied
```

**è§£å†³æ–¹æ³•**ï¼š
- å¦‚æœé•œåƒæ˜¯ç§æœ‰çš„ï¼Œéœ€è¦å…ˆç™»å½•ï¼š
```bash
echo $GITHUB_TOKEN | docker login ghcr.io -u ä½ çš„ç”¨æˆ·å --password-stdin
```
- æˆ–è€…å°†é•œåƒè®¾ç½®ä¸ºå…¬å¼€ï¼ˆå‚è§"é•œåƒå¯è§æ€§è®¾ç½®"éƒ¨åˆ†ï¼‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions å·¥ä½œæµæ–‡æ¡£](.github/workflows/README.md)
- [é¡¹ç›® README](README.md)
- [Docker æ„å»ºæ–‡æ¡£](DOCKER_BUILD_SUMMARY.md)

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å·²ç»æˆåŠŸå‘å¸ƒäº† 1.0.0 ç‰ˆæœ¬ï¼

ä¸‹ä¸€æ­¥ï¼š
- å°†å‘å¸ƒé“¾æ¥åˆ†äº«ç»™ç”¨æˆ·
- åœ¨ç¤¾äº¤åª’ä½“å®£å¸ƒå‘å¸ƒ
- æ”¶é›†ç”¨æˆ·åé¦ˆ
- è§„åˆ’ä¸‹ä¸€ä¸ªç‰ˆæœ¬

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ GitHub Issues ä¸­æå‡ºã€‚
